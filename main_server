import socket
import subprocess

length = None
quantity = None

script = "test.py"
arguments = ["-p", str(length), str(quantity)]

client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
client_socket.connect(("10.0.1.139", 6000)) #change to correct ip address

while True:
    data = client_socket.recv(1024)
    decoded_data = data.decode()

    if decoded_data[0:3] == "LEN":
        length = decoded_data[4:]
        length = float(length)
        print(f"{length} in")
    elif decoded_data[0:3] == "PCS":
        quantity = decoded_data[4:]
        print(f"{quantity} pcs")
    if decoded_data == "FIN":
        if length is not None and quantity is not None:
            print(f"length is {length} and quantity is {quantity}")
            arguments = ["-p", str(length), str(quantity)]
            subprocess.run(["moteus-venv/bin/python", script] + arguments)
            print("subprocess done")
            client_socket.send(bytes("DONE", "utf-8"))
            length = None
            quantity = None
